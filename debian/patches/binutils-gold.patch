--- hwloc-0.9.2.orig/configure.ac
+++ hwloc-0.9.2/configure.ac
@@ -375,6 +375,7 @@
     AC_CHECK_HEADERS([X11/Xlib.h],
       [AC_CHECK_HEADERS([X11/Xutil.h X11/keysym.h],
         [enable_X11=yes
+         AC_SUBST([HWLOC_X11_LIBS], ["-lX11"])
          AC_DEFINE([HAVE_X11], [1], [Define to 1 if X11 libraries are available.])],,
         [[#include <X11/Xlib.h>]])
       ])
--- hwloc-0.9.2.orig/aclocal.m4
+++ hwloc-0.9.2/aclocal.m4
@@ -1,1 +1,1 @@
-# generated automatically by aclocal 1.11 -*- Autoconf -*-
+# generated automatically by aclocal 1.11 -*- Autoconf -*-
--- hwloc-0.9.2.orig/configure
+++ hwloc-0.9.2/configure
@@ -785,6 +785,7 @@
 XML_CFLAGS
 HAVE_CAIRO_FALSE
 HAVE_CAIRO_TRUE
+HWLOC_X11_LIBS
 CAIRO_LIBS
 CAIRO_CFLAGS
 HAVE_LIBIBVERBS_FALSE
@@ -7202,6 +7203,8 @@
 #define `$as_echo "HAVE_$ac_header" | $as_tr_cpp` 1
 _ACEOF
  enable_X11=yes
+         HWLOC_X11_LIBS="-lX11"
+
 
 $as_echo "#define HAVE_X11 1" >>confdefs.h
 
--- hwloc-0.9.2.orig/Makefile.in
+++ hwloc-0.9.2/Makefile.in
@@ -181,6 +181,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/src/Makefile.in
+++ hwloc-0.9.2/src/Makefile.in
@@ -185,6 +185,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/include/Makefile.in
+++ hwloc-0.9.2/include/Makefile.in
@@ -142,6 +142,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/tests/Makefile.in
+++ hwloc-0.9.2/tests/Makefile.in
@@ -272,6 +272,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/tests/linux/Makefile.in
+++ hwloc-0.9.2/tests/linux/Makefile.in
@@ -104,6 +104,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/tests/ports/Makefile.in
+++ hwloc-0.9.2/tests/ports/Makefile.in
@@ -131,6 +131,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/doc/Makefile.in
+++ hwloc-0.9.2/doc/Makefile.in
@@ -153,6 +153,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
--- hwloc-0.9.2.orig/utils/Makefile.am
+++ hwloc-0.9.2/utils/Makefile.am
@@ -4,7 +4,7 @@
 include $(top_srcdir)/hwloc.am
 include $(top_srcdir)/Makefile.man-page-rules
 
-LIBS = $(top_builddir)/src/libhwloc.la
+LIBS += $(top_builddir)/src/libhwloc.la
 
 EXTRA_DIST = test-hwloc-distrib.output
 
@@ -21,7 +21,7 @@
 lstopo_SOURCES += lstopo-windows.c
 endif
 lstopo_CFLAGS = $(CAIRO_CFLAGS) $(XML_CFLAGS)
-lstopo_LDADD = $(CAIRO_LIBS) $(XML_LIBS) -lm
+lstopo_LDADD = $(CAIRO_LIBS) $(XML_LIBS) -lm $(HWLOC_X11_LIBS)
 
 hwloc_mask_SOURCES = hwloc-mask.c hwloc-mask.h
 
--- hwloc-0.9.2.orig/utils/Makefile.in
+++ hwloc-0.9.2/utils/Makefile.in
@@ -98,7 +98,8 @@
 	$(am__objects_1) $(am__objects_2) $(am__objects_3)
 lstopo_OBJECTS = $(am_lstopo_OBJECTS)
 am__DEPENDENCIES_1 =
-lstopo_DEPENDENCIES = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1)
+lstopo_DEPENDENCIES = $(am__DEPENDENCIES_1) $(am__DEPENDENCIES_1) \
+	$(am__DEPENDENCIES_1)
 lstopo_LINK = $(LIBTOOL) --tag=CC $(AM_LIBTOOLFLAGS) $(LIBTOOLFLAGS) \
 	--mode=link $(CCLD) $(lstopo_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) \
 	$(LDFLAGS) -o $@
@@ -188,6 +189,7 @@
 HWLOC_REQUIRES = @HWLOC_REQUIRES@
 HWLOC_SVN_R = @HWLOC_SVN_R@
 HWLOC_VERSION = @HWLOC_VERSION@
+HWLOC_X11_LIBS = @HWLOC_X11_LIBS@
 INSTALL = @INSTALL@
 INSTALL_DATA = @INSTALL_DATA@
 INSTALL_PROGRAM = @INSTALL_PROGRAM@
@@ -198,7 +200,7 @@
 LD = @LD@
 LDFLAGS = @LDFLAGS@
 LIBOBJS = @LIBOBJS@
-LIBS = $(top_builddir)/src/libhwloc.la
+LIBS = @LIBS@ $(top_builddir)/src/libhwloc.la
 LIBTOOL = @LIBTOOL@
 LIPO = @LIPO@
 LN_S = @LN_S@
@@ -299,7 +301,7 @@
 	lstopo-draw.c lstopo-fig.c $(am__append_1) $(am__append_2) \
 	$(am__append_3)
 lstopo_CFLAGS = $(CAIRO_CFLAGS) $(XML_CFLAGS)
-lstopo_LDADD = $(CAIRO_LIBS) $(XML_LIBS) -lm
+lstopo_LDADD = $(CAIRO_LIBS) $(XML_LIBS) -lm $(HWLOC_X11_LIBS)
 hwloc_mask_SOURCES = hwloc-mask.c hwloc-mask.h
 @HAVE_MINGW32_FALSE@TESTS = test-hwloc-distrib.sh
 man_pages = lstopo.1 hwloc-bind.1 hwloc-distrib.1 hwloc-mask.1
